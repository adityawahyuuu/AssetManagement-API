name: PR Validation

# Run on pull requests to main branches
on:
  pull_request:
    types: [opened, synchronize, reopened, ready_for_review]
    branches:
      - development
      - main
      - master

permissions:
  pull-requests: write

jobs:
  # Validate PR title and description
  pr-metadata:
    name: Validate PR Metadata
    runs-on: ubuntu-latest
    # Skip if PR is in draft mode
    if: ${{ !github.event.pull_request.draft }}

    steps:
      - name: Validate PR title
        run: |
          PR_TITLE="${{ github.event.pull_request.title }}"

          if [ -z "$PR_TITLE" ]; then
            echo "❌ ERROR: PR title is empty"
            exit 1
          fi

          if [ ${#PR_TITLE} -lt 10 ]; then
            echo "❌ ERROR: PR title is too short (minimum 10 characters)"
            exit 1
          fi

          echo "✅ PR title is valid"

      - name: Check PR description
        run: |
          PR_BODY="${{ github.event.pull_request.body }}"

          if [ -z "$PR_BODY" ] || [ "$PR_BODY" == "null" ]; then
            echo "⚠️ PR description is empty"
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "### PR Description Guidelines" >> $GITHUB_STEP_SUMMARY
            echo "Consider adding a description with:" >> $GITHUB_STEP_SUMMARY
            echo "- What changes were made" >> $GITHUB_STEP_SUMMARY
            echo "- Why these changes were needed" >> $GITHUB_STEP_SUMMARY
            echo "- How to test the changes" >> $GITHUB_STEP_SUMMARY
          else
            echo "✅ PR has a description"
          fi

      - name: Summary
        run: |
          echo "## PR Validation" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "✅ Draft check: PR is not in draft mode" >> $GITHUB_STEP_SUMMARY
          echo "✅ Title validation: Passed" >> $GITHUB_STEP_SUMMARY
          echo "✅ Description check: Complete" >> $GITHUB_STEP_SUMMARY